---
title: "R Graphics with ggplot2"
author: "Clay Ford"
date: "Fall 2015"
output: beamer_presentation
---

## Workshop plan

- overview of ggplot2 philosophy and logic
- quick, exploratory graphs
- fine tuning graphs
- common manipulation tasks to get your data ready for ggplot2


## The ggplot2 philosophy

- ggplot2 is based on the *Grammar of Graphics*, a book by Leland Wilkinson
- Instead of thinking in terms of types of graphs (scatterplots, histograms), we think in terms of **mapping** data to **aesthetic** properties of **geometric shapes**
- If you know the grammar of graphics, ggplot2 allows you to compose novel graphs that are not restricted by a set of canned templates

## The Grammar of Graphics

There's an entire book on this, but I'll attempt to boil it down to one slide (*courtesy of Wickham, 2009, p. 3*):

- A statistical graphic is a mapping from data to aesthetic attributes (location, color, shape, size) of geometric objects (points, lines, bars). 

- Scales control the mapping from data to aesthetic and provide tools to read the plot (ie, axes and legends).

- The geometric objects are drawn in a specific coordinate system.

- The plot may also contain statistical transformations of the data (means, medians, bins of data).

- Faceting can be used to generate the same plot for different subsets of the data.


## Getting Started

- ggplot2 is an R package that has to be installed:   
  `install.packages("ggplot2")`
  
- Once installed, you need to load it once per R session if you want to use it:   
  `library(ggplot2)`

- Graphs are created with ggplot2 by layering (or adding) functions. You actually use a `+` symbol between functions.  
Example:  
`ggplot(data=vitals, aes(x=weight, y=height)) + geom_point()`  
This creates a scatterplot of height vs. weight.

## Basic ggplot structure

**Specify data and aesthetics**   
`ggplot(data, aes(x=, y=, color=, shape=, size=)) +`   

**Specify geometric shape(s)**  
`geom_xxxxx()`   

This combination is very effective for exploratory graphs. You can also add multiple geoms.

Every `geom_*()` function has a default statistical transformation and scale, which can be modified with `stat_*()` and `scale_*()` functions.

## Extending ggplot graphs

We can extend and/or tweak ggplot graphs using the following functions:

**Specify statistical, scale or coordinate changes**   
`stat_xxxx() +` or `scale_xxxx() +` or `coord_xxxx() +`   

**Specify how to layout graphs of subsetted data**   
`facet_xxxx() +`   

**Specify themes and labels**   
`theme_xxxx() + labs(title=, x=, y=)`

Notice the `+` signs. We add, or layer, these specifications to `ggplot()`

## ggplot example - basic

```{r, message=FALSE, fig.height=3, fig.width=6}
library(ggplot2) # once per session
ggplot(iris, aes(x = Petal.Width, y = Sepal.Width, 
                 color=Species)) + 
  geom_point() 
```

## ggplot example - update labels

```{r, message=FALSE, fig.height=3, fig.width=6}
ggplot(iris, aes(x = Petal.Width, y = Sepal.Width, 
                 color=Species)) + geom_point() +
  labs(title="Sepal vs. Petal", 
       x="Petal Width (cm)", y="Sepal Width (cm)") 

```

## ggplot example - update y-axis

```{r, message=FALSE, fig.height=3, fig.width=6}
ggplot(iris, aes(x = Petal.Width, y = Sepal.Width, 
                 color=Species)) + geom_point() +
  scale_y_continuous(limits=c(0,5), breaks=seq(0,5,0.5))

```

## ggplot example - zoom in on plot

```{r, message=FALSE, fig.height=3, fig.width=6}
ggplot(iris, aes(x = Petal.Width, y = Sepal.Width, 
                 color=Species)) + geom_point() +
  coord_cartesian(xlim = c(0,1.5), ylim=c(3,4))

```


## ggplot example - change theme

```{r, message=FALSE, fig.height=3, fig.width=6}
ggplot(iris, aes(x = Petal.Width, y = Sepal.Width, 
                 shape=Species)) + geom_point() +
  theme_bw()

```

## ggplot example - add multiple geoms

```{r, message=FALSE, fig.height=3, fig.width=6}
ggplot(iris, aes(x = Petal.Width, y = Sepal.Width, 
                 color=Species)) + 
  geom_point() + geom_smooth(method="lm") 
```

## ggplot example - faceting

```{r, message=FALSE, fig.height=3, fig.width=6}
ggplot(iris, aes(x = Petal.Width)) +
  geom_histogram(binwidth=0.2) + facet_wrap(~ Species) 
```

## ggplot example - adding a statistical transformation

```{r, message=FALSE, fig.height=3, fig.width=6}
ggplot(iris, aes(x = Species, y=Petal.Width)) +
  geom_boxplot() + 
  stat_summary(fun.y = mean, geom="point", color="red")
```


## ggplot2 - points to remember

- Can do a lot with `ggplot(data, aes()) + geom_xxx()`!
- Data must be a data frame (not a matrix or collection of vectors)
- Data often must be in _long_ format, which sometimes means reshaping data
- Does not do 3D plots
- The online R documentation has many good examples

Let's go to R!

## References

Wickham, H. (2009), _ggplot2: Elegant Graphics for Data Analysis_, Springer.

Wickham, H. (2010), "A Layered Grammar of Graphics", _Journal of Computational and Graphical Statistics_, Volume 19, Number 1.

Chang, W. (2013), _R Graphics Cookbook_, O'Reilly.

**ggplot2 cheat sheet**    
http://www.rstudio.com/wp-content/uploads/2015/04/ggplot2-cheatsheet.pdf

**R Graph Catalog**   
http://shinyapps.stat.ubc.ca/r-graph-catalog/


## StatLab

Thanks for coming today!

For help and advice with your data analysis, contact StatLab to set up an appointment: statlab@virginia.edu

Sign up for more workshops or see past workshops:
http://data.library.virginia.edu/statlab/

Register for the Research Data Services newsletter to stay up-to-date on StatLab events and resources: http://data.library.virginia.edu/newsletters/



